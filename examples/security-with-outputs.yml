name: Security Scan with Output Handling

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  security-scan:
    uses: renan-org/shared-security-scan/.github/workflows/security-scan.yml@v1.0.0
    with:
      scan-target: '.'
      upload-artifact: true

  handle-results:
    needs: security-scan
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Scan Results
        run: |
          echo "ğŸ” Security Scan Completed"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Status: ${{ needs.security-scan.outputs.scan-result }}"
          echo "Timestamp: ${{ needs.security-scan.outputs.scan-timestamp }}"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: Fail on security warnings
        if: needs.security-scan.outputs.scan-result == 'warning'
        run: |
          echo "âš ï¸  Security issues detected!"
          exit 1

      - name: Success
        if: needs.security-scan.outputs.scan-result == 'passed'
        run: echo "âœ… All security checks passed!"
